==40991== Memcheck, a memory error detector
==40991== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
==40991== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
==40991== Command: ./rtv1 test.json
==40991== 
--40991-- run: /usr/bin/dsymutil "./rtv1"
==40991== Conditional jump or move depends on uninitialised value(s)
==40991==    at 0x7FFF5FC23DC7: bcmp (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC11AF4: ImageLoaderMachO::validateFirstPages(linkedit_data_command const*, int, unsigned char const*, unsigned long, long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC16D6A: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, encryption_info_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC10C5E: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC038C2: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC085BF: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC082DF: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC08044: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC07799: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0347A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0315E: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC088F9: dyld::libraryLocator(char const*, bool, char const*, ImageLoader::RPathChain const*) (in /usr/lib/dyld)
==40991== 
==40991== Use of uninitialised value of size 8
==40991==    at 0x7FFF5FC23DDF: bcmp (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC11AF4: ImageLoaderMachO::validateFirstPages(linkedit_data_command const*, int, unsigned char const*, unsigned long, long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC16D6A: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, encryption_info_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC10C5E: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC038C2: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC085BF: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC082DF: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC08044: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC07799: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0347A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0315E: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC088F9: dyld::libraryLocator(char const*, bool, char const*, ImageLoader::RPathChain const*) (in /usr/lib/dyld)
==40991== 
==40991== Use of uninitialised value of size 8
==40991==    at 0x7FFF5FC23DE4: bcmp (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC11AF4: ImageLoaderMachO::validateFirstPages(linkedit_data_command const*, int, unsigned char const*, unsigned long, long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC16D6A: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, encryption_info_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC10C5E: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC038C2: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC085BF: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC082DF: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC08044: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC07799: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0347A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0315E: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC088F9: dyld::libraryLocator(char const*, bool, char const*, ImageLoader::RPathChain const*) (in /usr/lib/dyld)
==40991== 
==40991== Conditional jump or move depends on uninitialised value(s)
==40991==    at 0x7FFF5FC11AF7: ImageLoaderMachO::validateFirstPages(linkedit_data_command const*, int, unsigned char const*, unsigned long, long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC16D6A: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, encryption_info_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC10C5E: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC038C2: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC085BF: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC082DF: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC08044: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC07799: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0347A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0315E: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC088F9: dyld::libraryLocator(char const*, bool, char const*, ImageLoader::RPathChain const*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0EA4D: ImageLoader::recursiveLoadLibraries(ImageLoader::LinkContext const&, bool, ImageLoader::RPathChain const&) (in /usr/lib/dyld)
==40991== 
==40991== Invalid write of size 8
==40991==    at 0x100003C74: add_texture (parse_images.c:23)
==40991==    by 0x1000040E9: parse_image (parse_images.c:67)
==40991==    by 0x1000041AC: parse_material_images (parse_images.c:80)
==40991==    by 0x1000042F4: parse_images (parse_images.c:108)
==40991==    by 0x10000662C: parser (parser.c:21)
==40991==    by 0x100002939: main (main.c:257)
==40991==  Address 0x10ed795f8 is 0 bytes after a block of size 8 alloc'd
==40991==    at 0x100050AAB: malloc (in /Users/hmartzol/.brew/Cellar/valgrind/3.11.0/lib/valgrind/vgpreload_memcheck-amd64-darwin.so)
==40991==    by 0x10001215B: ft_malloc (ft_malloc.c:28)
==40991==    by 0x1000142EC: ft_reallocf (ft_reallocf.c:23)
==40991==    by 0x100004090: parse_image (parse_images.c:63)
==40991==    by 0x1000041AC: parse_material_images (parse_images.c:80)
==40991==    by 0x1000042F4: parse_images (parse_images.c:108)
==40991==    by 0x10000662C: parser (parser.c:21)
==40991==    by 0x100002939: main (main.c:257)
==40991== 
==40991== Invalid read of size 1
==40991==    at 0x1000123B0: ft_memmove (ft_memmove.c:22)
==40991==    by 0x100014353: ft_reallocf (ft_reallocf.c:30)
==40991==    by 0x1000046F4: parse_object_material (parse_objects.c:27)
==40991==    by 0x10000504A: parse_object (parse_objects.c:115)
==40991==    by 0x1000052AB: parse_objects (parse_objects.c:140)
==40991==    by 0x1000066F4: parser (parser.c:33)
==40991==    by 0x100002939: main (main.c:257)
==40991==  Address 0x10ed79a4f is 1 bytes before a block of size 560 alloc'd
==40991==    at 0x100050AAB: malloc (in /Users/hmartzol/.brew/Cellar/valgrind/3.11.0/lib/valgrind/vgpreload_memcheck-amd64-darwin.so)
==40991==    by 0x10001215B: ft_malloc (ft_malloc.c:28)
==40991==    by 0x100005207: parse_objects (parse_objects.c:134)
==40991==    by 0x1000066F4: parser (parser.c:33)
==40991==    by 0x100002939: main (main.c:257)
==40991== 
Initializing OpenCL environement...
--40991-- UNKNOWN mach_msg unhandled MACH_SEND_TRAILER option
--40991-- UNKNOWN mach_msg unhandled MACH_SEND_TRAILER option (repeated 2 times)
--40991-- UNKNOWN mach_msg unhandled MACH_SEND_TRAILER option (repeated 4 times)

valgrind: m_syswrap/syswrap-amd64-darwin.c:507 (void wqthread_hijack(Addr, Addr, Addr, Addr, Int, Addr)): Assertion 'tst->os_state.pthread - magic_delta == self' failed.

host stacktrace:
==40991==    at 0x23803FD3F: ???
==40991==    by 0x238040138: ???
==40991==    by 0x23804011B: ???
==40991==    by 0x2380DDD93: ???

sched status:
  running_tid=0

Thread 1: status = VgTs_WaitSys (lwpid 2567)
==40991==    at 0x7FFF5FC265E2: pread (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC037E2: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC085BF: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC082DF: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC08044: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC07799: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0347A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0315E: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==40991==    by 0x7FFF5FC0C260: dlopen (in /usr/lib/dyld)
==40991==    by 0x108F4779B: dlopen (in /usr/lib/system/libdyld.dylib)
==40991==    by 0x100078BD9: clSetEventCallback (in /System/Library/Frameworks/OpenCL.framework/Versions/A/OpenCL)
==40991==    by 0x10924ABF5: __pthread_once_handler (in /usr/lib/system/libsystem_pthread.dylib)
==40991==    by 0x109236FC3: _os_once (in /usr/lib/system/libsystem_platform.dylib)
==40991==    by 0x10924AB94: pthread_once (in /usr/lib/system/libsystem_pthread.dylib)
==40991==    by 0x100078B4F: clSetEventCallback (in /System/Library/Frameworks/OpenCL.framework/Versions/A/OpenCL)
==40991==    by 0x1000791F6: clGetDeviceIDs (in /System/Library/Frameworks/OpenCL.framework/Versions/A/OpenCL)
==40991==    by 0x100008E17: ftocl_data (in ./rtv1)
==40991==    by 0x1000091E2: ftocl_make_program (ftocl_make_program.c:80)
==40991==    by 0x1000029AB: main (main.c:262)

Thread 2: status = VgTs_WaitSys (lwpid 4099)
==40991==    at 0x1090F35E2: __workq_kernreturn (in /usr/lib/system/libsystem_kernel.dylib)
==40991==    by 0x70014: ???
==40991==    by 0x7000051B3DBF: ???
==40991==    by 0x2382001AF: ???
==40991==    by 0x7000003A92AF: ???

Thread 3: status = VgTs_Yielding (lwpid 5635)
==40991==    at 0x1090F3EFA: kevent_qos (in /usr/lib/system/libsystem_kernel.dylib)
==40991==    by 0x108EF5DCC: _dispatch_mgr_thread (in /usr/lib/system/libdispatch.dylib)


Note: see also the FAQ in the source distribution.
It contains workarounds to several common problems.
In particular, if Valgrind aborted or crashed after
identifying problems in your program, there's a good chance
that fixing those problems will prevent Valgrind aborting or
crashing, especially if it happened in m_mallocfree.c.

If that doesn't help, please report this bug to: www.valgrind.org

In the bug report, send all the above text, the valgrind
version, and what OS and version you are using.  Thanks.
